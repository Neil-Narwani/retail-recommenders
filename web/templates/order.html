{% extends "layout.html" %}


{% block styles %}
<style>
  .badge-notify{
    background:red;
    position:relative;
    top: -20px;
    right: 10px;
  }
  .my-cart-icon-affix {
    position: fixed;
    z-index: 999;
  }
</style>
{% endblock %}

{% block scripts %}


<script src="{{url_for('static', filename='js/jquery-2.2.3.min.js')}}"></script>
<script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.mycart.js')}}"></script>
<script type="text/javascript">
  $(
    function () {
      var goToCartIcon = function($addTocartBtn){
        var $cartIcon = $(".my-cart-icon");
        var $image = $('<img width="30px" height="30px" src="' + $addTocartBtn.data("image") + '"/>').css({"position": "fixed", "z-index": "999"});
        $addTocartBtn.prepend($image);
        var position = $cartIcon.position();
        $image.animate({
          top: position.top,
          left: position.left
        }, 500 , "linear", function() {
          $image.remove();
        });
      }
      var options = {
        currencySymbol: '$',
        classCartIcon: 'my-cart-icon',
        classCartBadge: 'my-cart-badge',
        classProductQuantity: 'my-product-quantity',
        classProductRemove: 'my-product-remove',
        classCheckoutCart: 'my-cart-checkout',
        classRecommendCart: 'my-cart-recommend',
        affixCartIcon: true,
        showCheckoutModal: true,
        numberOfDecimals: 2,
        clickOnAddToCart: function($addTocart){
          goToCartIcon($addTocart);
        },
        afterAddOnCart: function(products, totalPrice, totalQuantity) {
          console.log("afterAddOnCart", products, totalPrice, totalQuantity);
        },
        clickOnCartIcon: function($cartIcon, products, totalPrice, totalQuantity) {
          console.log("cart icon clicked", $cartIcon, products, totalPrice, totalQuantity);
        },
        recommendCart: function(products, totalPrice, totalQuantity) {
          $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "/recommend",
            data: JSON.stringify({products: products}),
            success: function (data) {
                var myDiv = document.getElementById("showresults");
                console.log(data)
                myDiv.innerHTML = data
            },
            dataType: "json"
          });
        },
        checkoutCart: function(products, totalPrice, totalQuantity) {
          // return false, from this function 
          // if precondition of checking out is invalid
          // if(!willProceedToCheckout) return false;
          var checkoutString = "Total Price: " + totalPrice + "\nTotal Quantity: " + totalQuantity;
          checkoutString += "\n\n id \t name \t summary \t price \t quantity \t image path";
          $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "/checkout",
            data: JSON.stringify({products: products}),
            success: function (data) {
                window.location.href = data['redirect'];
            },
            dataType: "json"
          });

          $.each(products, function(){
            checkoutString += ("\n " + this.id + " \t " + this.name + " \t " + this.summary + " \t " + this.price + " \t " + this.quantity + " \t " + this.image);
          });
          alert(checkoutString)
          console.log("checking out", products, totalPrice, totalQuantity);
        },
        getDiscountPrice: function(products, totalPrice, totalQuantity) {
          console.log("calculating discount", products, totalPrice, totalQuantity);
          return totalPrice * 0.5;
        }
      };
      $(".my-cart-btn").myCart(options);
  });
</script>
{% endblock %}

{% block content %}
<h1>Order Creation and Recommendation</h1>
<p>Create custom orders and get item recommendations based off of your order.</p>

<h2>Select Items to Order</h2>
<div style="float: right; cursor: pointer;">
  <span class="bi-cart my-cart-icon"><span class="badge badge-notify my-cart-badge"></span></span>
</div>
{% if pages %}
<nav aria-label="Page navigation example">
  <ul class="pagination">
    <li class="page-item">
      <a class="page-link" href="/order/{{ pages.begin }}/{{limit}}">
        <span aria-hidden="true">&laquo;</span>
        <span class="sr-only">First</span>
      </a>
    </li>
    <li class="page-item">
      <a class="page-link" href="/order/{{ pages.prev }}/{{limit}}">
        <span aria-hidden="true">&lt;</span>
        <span class="sr-only">Previous</span>
      </a>
    </li>
    <li class="page-item">
      <a class="page-link" href="/order/{{ pages.next }}/{{limit}}">
        <span class="sr-only">Next</span>
        <span aria-hidden="true">&gt;</span>
      </a>
    </li>
    <li class="page-item">
      <a class="page-link" href="/order/{{ pages.end }}/{{limit}}">
        <span class="sr-only">Last</span>
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav> {% endif %}

<table class="table">
  <thead>
    <tr>
      <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    {% for index, row in items.iterrows(): %}
    <tr>
      <td>{{ row[1] }}</td>
      <td><button class="btn btn-danger my-cart-btn" data-id="{{row[0]}}" data-name="{{row[1]}}" data-summary="summary 2" data-price="20" data-quantity="1" data-image="{{url_for('static', filename='img/add.png')}}">Add to Cart</button></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div id="showresults" />
<!-- <td>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Your Cart</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</td> -->

{% endblock %}